"use strict";(self.webpackChunkcollective_z3cform_datagridfield=self.webpackChunkcollective_z3cform_datagridfield||[]).push([[245],{245:(e,t,i)=>{var d=i(288),n=(i(452),i(22)),o=i.n(n),a=i(553),r=i(505);r.A.setLevel("INFO");r.A.getLogger("datagridfield"),a.A.extend({name:"datagridfield",trigger:".pat-datagridfield",parser:"mockup",init:function(){i.e(267).then(i.bind(i,267)),this.el=this.$el[0],this.el_body=this.el.querySelector(".datagridwidget-body"),this.auto_append="false"!==(this.el.dataset.autoAppend||"true").toLowerCase(),this._defineHandler(),this.getVisibleRows().forEach((function(e){this.initRowUI(e)}),this),this.ensureMinimumRows()||this.updateOrderIndex(),this.initAutoAppendHandler(),this.el.dispatchEvent(new Event("afterdatagridfieldinit",{bubbles:!0,cancelable:!0}))},_defineHandler:function(){this.handler_auto_append=function(e){e&&e.stopPropagation(),e&&!e.target.closest(".datagridwidget-cell")||this.auto_append_row()}.bind(this),this.handler_auto_append_input=function(e){var t=e.currentTarget;t.classList.remove("auto-append"),t.dataset.oldIndex=t.dataset.index,delete t.dataset.index,this.updateOrderIndex(),t.removeEventListener("input",this.handler_auto_append_input)}.bind(this)},initRowUI:function(e){e.querySelectorAll(".dgf--row-add").forEach((function(t){t.addEventListener("click",function(t){t.preventDefault(),this.insertRow(e),this.updateOrderIndex()}.bind(this))}),this),e.querySelectorAll(".dgf--row-delete").forEach((function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),this.removeFieldRow(e)}.bind(this))}),this),e.querySelectorAll(".dgf--row-moveup").forEach((function(t){t.addEventListener("click",function(t){t.preventDefault(),this.moveRowUp(e)}.bind(this))}),this),e.querySelectorAll(".dgf--row-movedown").forEach((function(t){t.addEventListener("click",function(t){t.preventDefault(),this.moveRowDown(e)}.bind(this))}),this)},get_row_buttons:function(e){return{add:e.querySelector(".dgf--row-add"),delete:e.querySelector(".dgf--row-delete"),up:e.querySelector(".dgf--row-moveup"),down:e.querySelector(".dgf--row-movedown")}},setUIState:function(){for(var e=this.getVisibleRows(),t=0;t<e.length;t++){var i=e[t],d=this.get_row_buttons(i);if(!0===this.auto_append&&"AA"===i.dataset.index){if(d.add&&(d.add.disabled=!0),d.delete&&(d.delete.disabled=!0),d.up&&(d.up.disabled=!0),d.down&&(d.down.disabled=!0),t>0){var n=this.get_row_buttons(e[t-1]);n.down&&(n.down.disabled=!0)}}else 0===t?(d.add&&(d.add.disabled=!1),d.delete&&(d.delete.disabled=!1),d.up&&(d.up.disabled=!0),d.down&&(d.down.disabled=1===e.length)):t===e.length-1?(d.add&&(d.add.disabled=!1),d.delete&&(d.delete.disabled=!1),d.up&&(d.up.disabled=!1),d.down&&(d.down.disabled=!0)):(d.add&&(d.add.disabled=!1),d.delete&&(d.delete.disabled=!1),d.up&&(d.up.disabled=!1),d.down&&(d.down.disabled=!1))}},getRows:function(){return this.el_body.querySelectorAll(".datagridwidget-row")},getVisibleRows:function(){return this.el_body.querySelectorAll(".datagridwidget-row:not([data-index=TT])")},getLastRow:function(){return this.el_body.querySelector(".datagridwidget-row:last-child")},getLastVisibleRow:function(){var e=this.el_body.querySelectorAll(".datagridwidget-row:not([data-index=TT])");return e[e.length-1]},countRows:function(){var e=0;return this.getRows().forEach((function(t){-1===["AA","TT"].indexOf(t.dataset.index)&&e++}),this),e},initAutoAppendHandler:function(){if(this.auto_append){this.getVisibleRows().forEach((function(e){e.removeEventListener("focusout",this.handler_auto_append)}),this);var e=this.getLastVisibleRow();e&&e.addEventListener("focusout",this.handler_auto_append)}},auto_append_row:function(){this.el.dispatchEvent(new Event("beforeaddrowauto")),this.getVisibleRows().forEach((function(e){e.classList.remove("auto-append"),"TT"!==e.dataset.index&&(e.dataset.oldIndex=e.dataset.index,delete e.dataset.index)}));var e=this.getLastVisibleRow()||this.getLastRow(),t=this.insertRow(e);t.classList.add("auto-append"),this.reindexRow(t,"AA"),this.updateOrderIndex(),t.addEventListener("input",this.handler_auto_append_input),this.el.dispatchEvent(new Event("afteraddrowauto"))},insertRow:function(e,t){var i=this.createNewRow(),n=o()(i);return this.$el.trigger("beforeaddrow",[this.$el,n]),t?n.insertBefore(e):n.insertAfter(e),this.initRowUI(i),d.A.scan(n),this.initAutoAppendHandler(),this.$el.trigger("afteraddrow",[this.$el,n]),i},createNewRow:function(){var e=this.el_body.querySelector("[data-index=TT]");if(!e)throw new Error("Could not locate empty template row in DGF");var t=document.createElement("table");t.innerHTML=e.outerHTML,(t=t.querySelector("tr")).dataset.oldIndex=t.dataset.index,delete t.dataset.index,t.classList.remove("datagridwidget-empty-row");o()(t);const i="dgw-disabled-pat-";return t.querySelectorAll(`[class*="${i}"]`).forEach((e=>{e.classList.forEach((t=>{e.classList.replace(t,t.replace(i,"pat-"))}))})),t},removeFieldRow:function(e){o()(e).remove(),this.ensureMinimumRows()||this.updateOrderIndex(),this.updateOrderIndex(),this.initAutoAppendHandler()},moveRowDown:function(e){this.moveRow(e,"down"),this.updateOrderIndex(),this.initAutoAppendHandler()},moveRowUp:function(e){this.moveRow(e,"up"),this.updateOrderIndex(),this.initAutoAppendHandler()},moveRowToTop:function(e){var t=this.getRows();o()(e).insertBefore(t[0]),this.updateOrderIndex(),this.initAutoAppendHandler()},moveRowToBottom:function(e){var t=this.getRows(),i=0;o()(t).each((function(e,t){-1===["AA","TT"].indexOf(t.dataset.index)&&(i=e)})),o()(e).insertAfter(t[i]),this.updateOrderIndex(),this.initAutoAppendHandler()},moveRow:function(e,t){var i,d=this.getRows(),n=null;if(o()(d).each((function(t,i){e===i&&(n=t)})),null!==n){var a=this.countRows();n+1==a?"down"==t?this.moveRowToTop(e):(i=d[n-1],this.shiftRow(i,e)):0===n?"up"==t?this.moveRowToBottom(e):(i=d[parseInt(n+1,10)],this.shiftRow(e,i)):"up"==t?(i=d[n-1],this.shiftRow(i,e)):(i=d[parseInt(n+1,10)],this.shiftRow(e,i)),this.$el.trigger("aftermoverow",[this.$el,e])}},shiftRow:function(e,t){o()(t).insertBefore(e)},reindexRow:function(e,t){var i=this.el_body.dataset.name_prefix+".",d=this.el_body.dataset.id_prefix+"-",n=e.dataset.oldIndex||e.dataset.index;function o(e,i,d){var o=e.getAttribute(i);if(o){var a=new RegExp("^"+d+n);e.setAttribute(i,o.replace(a,d+t))}}delete e.dataset.oldIndex,e.dataset.index=t,e.querySelectorAll('[id^="formfield-'+d+'"]').forEach((function(e){o(e,"id","formfield-"+d)}),this),e.querySelectorAll('[name^="'+i+'"]').forEach((function(e){o(e,"name",i)}),this),e.querySelectorAll('[id^="'+d+'"]').forEach((function(e){o(e,"id",d)}),this),e.querySelectorAll('[for^="'+d+'"]').forEach((function(e){o(e,"for",d)}),this),e.querySelectorAll('[href*="#'+d+'"]').forEach((function(e){o(e,"href","#"+d)}),this),e.querySelectorAll('[data-fieldname^="'+i+'"]').forEach((function(e){o(e,"data-fieldname",i)}),this)},updateOrderIndex:function(){var e=0;this.getRows().forEach((function(t){var i=t.dataset.index;["AA","TT"].indexOf(i)>-1?this.reindexRow(t,i):(this.reindexRow(t,e),t.dataset.index=e,e++)}),this);var t=this.el_body.dataset.name_prefix+".";this.el.querySelector('input[name="'+t+'count"]').value=this.countRows(),this.setUIState()},getParentRow:function(e){var t=e.closest(".datagridwidget-row");return t||null},ensureMinimumRows:function(){var e=this.getRows(),t=this.getVisibleRows();return!(!e.length||0!==t.length)&&(this.auto_append_row(),!0)}});d.A.init()}}]);
//# sourceMappingURL=245.68c1fea4b716b78c19a5.min.js.map